<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KM Real World SQL</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
}

body {
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg, #020617, #0f172a);
  color: #e5e7eb;
}

/* ===== HEADER ===== */
header {
  text-align: center;
  padding: 30px 16px;
}

header img {
  width: 160px;
  margin-bottom: 16px;
  filter: drop-shadow(0 0 12px rgba(56,189,248,0.6));
}

h1 {
  font-size: 36px;
  margin: 0;
}

h1 span {
  color: #38bdf8;
}

.tagline {
  font-size: 18px;
  color: #f97316;
}

.author {
  font-size: 14px;
  color: #94a3b8;
}

/* ===== SECTIONS ===== */
.section {
  padding: 16px;
}

.box {
  background: rgba(2,6,23,0.85);
  border-left: 4px solid #38bdf8;
  border-radius: 10px;
  padding: 18px;
  margin-bottom: 16px;
}

.box h2 {
  margin-top: 0;
  font-size: 22px;
}

/* ===== INPUTS ===== */
select, textarea, button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #334155;
  border-radius: 6px;
  font-size: 16px;
}

textarea {
  min-height: 200px;
  font-family: monospace;
}

button {
  background: #38bdf8;
  color: #000;
  font-weight: bold;
}

/* ===== RESULT ===== */
.result {
  background: #020617;
  border: 1px solid #334155;
  border-radius: 6px;
  padding: 12px;
  margin-top: 12px;
  overflow-x: auto;
}

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #334155;
  padding: 8px;
}

/* ===== FOOTER ===== */
footer {
  text-align: center;
  padding: 16px;
  font-size: 12px;
  color: #94a3b8;
  border-top: 1px solid #334155;
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="KM Logo">
  <h1><span>KM</span> Real World SQL</h1>
  <div class="tagline">Build SQL skills, brick by brick</div>
  <div class="author">By Mallesh Gangula</div>
</header>

<div class="section">

  <!-- SELECTORS -->
  <div class="box">
    <h2>Choose your path</h2>

    <select id="field" onchange="loadTasks()">
      <option value="office">Office / Admin</option>
      <option value="logistics">Logistics</option>
      <option value="hospital">Hospital</option>
    </select>

    <select id="level" onchange="loadTasks()">
      <option value="1">Level 1 – Basics</option>
      <option value="2">Level 2 – Filtering</option>
      <option value="3">Level 3 – Conditions</option>
    </select>

    <select id="taskSelect" onchange="loadTask()"></select>
  </div>

  <!-- TASK -->
  <div class="box">
    <h2 id="taskTitle"></h2>
    <p id="taskDesc"></p>

    <textarea id="query"></textarea>
    <button onclick="runSQL()">▶ Run Query</button>

    <div class="result" id="output">Result will appear here</div>
  </div>

  <!-- EXPLANATION -->
  <div class="box">
    <h2>Why this works</h2>
    <p id="explanation"></p>
  </div>

</div>

<footer>
© 2025 KM Real World SQL · Created by Mallesh Gangula
</footer>

<script>
let db;

const tasks = {
  office: {
    1: [
      {
        title: "See all employees",
        desc: "View all employee records.",
        query: "SELECT * FROM employees;",
        explain: "SELECT * fetches all columns from the employees table."
      }
    ],
    2: [
      {
        title: "Salary greater than 30000",
        desc: "Filter employees by salary.",
        query: "SELECT * FROM employees WHERE salary > 30000;",
        explain: "WHERE filters rows based on conditions."
      }
    ]
  },
  logistics: {
    1: [
      {
        title: "View all shipments",
        desc: "See all shipments.",
        query: "SELECT * FROM shipments;",
        explain: "Used by logistics teams to monitor shipments."
      }
    ]
  },
  hospital: {
    1: [
      {
        title: "View all patients",
        desc: "List all patients.",
        query: "SELECT * FROM patients;",
        explain: "Hospitals use this to view patient data."
      }
    ]
  }
};

function loadTasks() {
  taskSelect.innerHTML = "";
  const list = tasks[field.value][level.value] || [];
  list.forEach((t, i) => {
    const o = document.createElement("option");
    o.value = i;
    o.textContent = `Task ${i + 1}: ${t.title}`;
    taskSelect.appendChild(o);
  });
  loadTask();
}

function loadTask() {
  const t = tasks[field.value][level.value][taskSelect.value];
  taskTitle.innerText = t.title;
  taskDesc.innerText = t.desc;
  query.value = t.query;
  explanation.innerText = t.explain;
  output.innerHTML = "Result will appear here";
}

function runSQL() {
  try {
    const r = db.exec(query.value);
    if (!r.length) {
      output.innerHTML = "No results.";
      return;
    }
    let html = "<table><tr>";
    r[0].columns.forEach(c => html += `<th>${c}</th>`);
    html += "</tr>";
    r[0].values.forEach(row => {
      html += "<tr>";
      row.forEach(cell => html += `<td>${cell}</td>`);
      html += "</tr>";
    });
    html += "</table>";
    output.innerHTML = html;
  } catch {
    output.innerHTML = "❌ SQL Error";
  }
}

initSqlJs({ locateFile: f => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${f}` })
.then(SQL => {
  db = new SQL.Database();
  db.run(`
    CREATE TABLE employees(id INT,name TEXT,department TEXT,salary INT);
    INSERT INTO employees VALUES
    (1,'Zeb','Admin',40000),
    (2,'Arjun','HR',60000);

    CREATE TABLE shipments(id INT,status TEXT);
    INSERT INTO shipments VALUES (1,'Pending');

    CREATE TABLE patients(id INT,name TEXT);
    INSERT INTO patients VALUES (1,'Rahul');
  `);
  loadTasks();
});
</script>

</body>
  </html>
